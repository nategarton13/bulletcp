<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Nate Garton" />

<meta name="date" content="2018-10-17" />

<title>Groove detection with a Bayesian changepoint model</title>






<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">Groove detection with a Bayesian changepoint model</h1>
<h4 class="author"><em>Nate Garton</em></h4>
<h4 class="date"><em>2018-10-17</em></h4>



<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>This package implements a Bayesian changepoint detection algorithm of the flavor found in “Bayesian Retrospective Multiple-Changepoint Identification” by D.A. Stephens in JRSS-c from 1994 (citation needed). This approach assumes that given an average of several 2D crosscuts from a 3D bullet land scan which has had the global structure removed via the robust LOESS procedure, the land engraved area (LEA) is fairly flat, and the groove engraved area (GEA) possesses an approximately linear structure with a nonzero slope. An example of this basic structure is given below.</p>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>The idea behind the changepoint approach is that within either the left GEA, right GEA, or the LEA, the global structure is consistent and can either be described by a line with zero slope, a line with positive slope for the right GEA, or a line with negative slope for the left GEA. The best fitting statistical model, in terms of the magnitude of the likelihood, should then be the one which assumes that the points at which the global structure changes align with where the GEA and LEA meet. Thus, our model will befined in a piecewise fashion. In practice there are also complex additional patterns which may result from a number of reasons, but this large scale structural assumption remains generally reasonable. The complex smaller scale patterns can be thought of as the dependence in the data after accounting for the global structure. Because of the nature of the model which we consider, it becomes necessary for computational reasons to perform a couple of data preprocessing steps. Specifically, we will scale the residuals from the robust LOESS procedure, and we will impute missing values. In the next section, we describe the model that we will use to identify changepoints, after which we will describe the estimation procedure which we use. Following that, we will describe the two main data preprocessing steps necessary for estimation to be computationally feasible.</p>
</div>
<div id="model" class="section level1">
<h1>Model</h1>
<p>Before introducing the model, we introduce some notation. First, let <span class="math inline">\(\{Y(x_i): i = 1,2, ..., n\}\)</span> denote the set of random variables representing the residuals from the robust LOESS procedure at the values <span class="math inline">\(x_i\)</span>. For simplicity, also assume that <span class="math inline">\(x_1 &lt; x_2 &lt; ... &lt; x_n\)</span>. Also, let <span class="math inline">\(c_l\)</span> be the value of the left changepoint and <span class="math inline">\(c_r\)</span> be the value of the right changepoint. Here, the left changepoint is where the left GEA meets the LEA, and the right changepoint is where the right GEA meets the LEA. Also, denote the median centered <span class="math inline">\(x\)</span> values as <span class="math inline">\(x'_i = x_i - \tilde{x}\)</span> where <span class="math inline">\(\tilde{x}\)</span> is the median <span class="math inline">\(x\)</span> value. As mentioned in the previous paragraph, the complex small scale patterns, such as the stria, will be modeled through a covariance structure on the data that will be allowed to differ between each GEA and between the GEAs and LEA. We will construct the covariance matrices from the exponential covariance function <span class="math inline">\(K(t, t';\sigma, \ell) = \sigma^2 e^{-\frac{|t - t'|}{\ell}}\)</span>. The differences in covariance matrices for the GEAs and LEA will be reflected in the parameters <span class="math inline">\(\sigma\)</span> and <span class="math inline">\(\ell\)</span>. The data model that we consider is then,</p>
<span class="math display">\[\begin{align}
(Y(x_1), Y(x_2), ..., Y(x_{k_1})) &amp;\sim N(\beta_{01}\mathbb{1} + \beta_{11} x'_{1:k_1}, \Sigma_1(\sigma_1, \ell_1)) \\
(Y(x_{k_1 + 1}), Y(x_{k_1 + 2}), ..., Y(x_{k_2})) &amp;\sim N(0, \Sigma_2(\sigma_2, \ell_2)) \\ 
(Y(x_{k_2 + 1}), Y(x_{k_2 + 2}), ..., Y(x_n)) &amp;\sim N(\beta_{02}\mathbb{1} + \beta_{12} x'_{k_2 + 1:n}, \Sigma_3(\sigma_3, \ell_3)),
\end{align}\]</span>
<p>where <span class="math inline">\(x_{k_1} &lt; c_l \leq x_{k_1 + 1}\)</span> and <span class="math inline">\(x_{k_2} &lt; c_l \leq x_{k_2 + 1}\)</span> Here, <span class="math inline">\(x_{1:k}\)</span> denotes the column vector <span class="math inline">\((x_1, x_2, ..., x_n)^\top\)</span>, and <span class="math inline">\(\mathbb{1}\)</span> denotes the vector of ones. Indpendence is assumed between each of these three distributions for simplicity.</p>
<p>Thus the parameters that need to be estimated include the four mean parameters in the GEAs, the six covariance parameters (two for each of the three areas), and the two changepoint parameters, <span class="math inline">\(c_l\)</span> and <span class="math inline">\(c_r\)</span>.</p>
<p>The above model encapsulates the essence of the approach. However, there are a few difficulties. The first difficulty is that there are not always two GEAs in a particular land. There may be one GEA, or the land may only consist of the LEA. Thus, the above model is actually conditional on there being two GEAs in the data. We also define models for when there is one GEA on the left, one GEA on the right, or no GEAs. The models are defined in an essentially identical way. Conditional on there being only one GEA, the left GEA model is defined as,</p>
<span class="math display">\[\begin{align}
(Y(x_1), Y(x_2), ..., Y(x_{k})) &amp;\sim N(\beta_{0}\mathbb{1} + \beta_{1} x'_{1:k}, \Sigma_1(\sigma_1, \ell_1)) \\
(Y(x_{k + 1}), Y(x_{k + 2}), ..., Y(x_{n})) &amp;\sim N(0, \Sigma_2(\sigma_2, \ell_2)),
\end{align}\]</span>
<p>and the right GEA model is defined as,</p>
<span class="math display">\[\begin{align}
(Y(x_{1}), Y(x_{2}), ..., Y(x_{k})) &amp;\sim N(0, \Sigma_1(\sigma_1, \ell_1)) \\ 
(Y(x_{k + 1}), Y(x_{k + 2}), ..., Y(x_n)) &amp;\sim N(\beta_{0}\mathbb{1} + \beta_{1} x'_{k + 1:n} \Sigma_2(\sigma_2, \ell_2)).
\end{align}\]</span>
<p>Finally, conditional on there being no GEAs in the data, the model is simply</p>
<span class="math display">\[\begin{align}
(Y(x_{1}), Y(x_{2}), ..., Y(x_{n})) &amp;\sim N(0, \Sigma(\sigma, \ell)).
\end{align}\]</span>
<p>Thus, estimating the changepoint locations also involves selecting the most appropriate model. In order to avoid confusion, we have slightly abused notation and, for example, <span class="math inline">\(\Sigma_1(\sigma_1, \ell_1)\)</span> as it is estimated in the two changepoint model is <em>not</em> the same as <span class="math inline">\(\Sigma_1(\sigma_1, \ell_1)\)</span> from the one changepoint model. Assuming that there is a left GEA, one would expect these two covariance matrices to be the same, but this is not enforced in the model, as this would significantly complicate the estimation procedure.</p>
<p>For clarity, ultimately, these above four models are each individually fitted, and priors are put on the number changepoints (and on whether the changepoint is to the left or right in the one changepoint model). From there, we do model selection in the formal Bayesian way, selecting the most probable number of changepoints. At this point, we select a suitable estimator for the changepoint locations (we will use the maximum a posterior estimate).</p>
<p>In order to complete a Bayesian model specification, we need priors on each of the parameters in each model as well as each model. We will assume independence between each parameter a priori. For each length scale <span class="math inline">\(\ell\)</span>, we will assume <span class="math inline">\(\ell \sim \text{Gamma}(3,5)\)</span>. For each standard deviation, we will assume <span class="math inline">\(\sigma \sim \text{Half-Normal}^{+}(0,1)\)</span>, where <span class="math inline">\(\text{Half-Normal}^{+}(\cdot,\cdot)\)</span> is notation for the normal distribution restricted to the positive real numbers. For intercept parameters, <span class="math inline">\(\beta_{01}, \beta_{02}, \beta_0 \sim N(0, 10)\)</span>. For the slope parameters, the preceding trend deviates slightly. For any slope that corresponds to the left GEA, <span class="math inline">\(\beta_1\)</span> or <span class="math inline">\(\beta_{01}\)</span>, we will assume that the slope can not be positive. That is, <span class="math inline">\(\beta_1, \beta_{01} \sim \text{Half-Normal}^{-}(0,10)\)</span>, where <span class="math inline">\(\text{Half-Normal}^{-}(\cdot, \cdot)\)</span> is notation for the normal distribution restricted to the negative real numbers. For the changepoint locations, we assume a uniform prior <span class="math inline">\(\pi(c_l, c_r) \propto I(a &lt; c_l &lt; c_r - \gamma &lt; b - \gamma)\)</span>. Here, <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> are some values close to the edges of the data. How close those values are to the edges is a parameter that is set manually. Further, we include another hyperparameter, <span class="math inline">\(\gamma\)</span>, which can be set so that the changepoints are not allowed to too close to each other. This is also a parameter that is set manually. Lastly, we assume a uniform prior over all four models.</p>
</div>
<div id="estimation" class="section level1">
<h1>Estimation</h1>
<p>As was noted in Stephens 1994 (citation needed), for any model including a changepoint, the likelihood is not a smooth function of the changepoint location. This is because, holding all other parameters fixed, shifting the changepoint value will result in zero change to the likelihood until it crosses the nearest point to the right or left, at which point the likelihood makes a jump. This makes maximum likelihood estimation infeasible, but Bayesian estimation can be done in a fairly straightforward way via Gibbs sampling. The basic idea is that, for each model, we can construct a two step Gibbs sampler. In step 1 we sample from the posterior distribution of the mean and covariance parameters given the changepoint locations, and in step 2 we sample from the changepoint locations given the mean and covariance parameters. Because of the non-conjugacy in our model, we perform both sampling steps using a random walk Metropolis-Hastings (RWMH) step with Gaussian proposals. For details on Gibbs sampling and the Metropolis-Hastings algorithm, see BDA3 (citation needed). It is also worth mentioning that the zero changepoint model does not require Gibbs sampling at all, and we perform estimation there using a RWMH algorithm.</p>
<p>As a practical note, it turns out that the posterior distribution is almost always multimodal, and it can happen that the sampler gets stuck in a suboptimal mode, with a potential changepoint located far from the groove locations, for a large number of iterations. It is also the case that the suboptimal modes need not even be close to the groove locations. It has, however, been our experience that the optimal mode corresponds well to the actual groove locations, which are often somewhat close to the edges of the data. With this in mind, starting values and the RWMH proposal variances play a very important role in the success of the sampling algorithm. Fortunately, it seems to be the case that by setting the initial changepoint values close to the edges of the data and making the proposal variance small (around 100 seems to work well) allows the sampler to wander inwards, and even with a modest number of iterations (say 5000), pass through the largest mode corresponding to the groove locations.</p>
<p>The sampling functions were originally written with the intention of tuning the proposal variances to potentially accelerate convergence, and thus several warmup iterations are required for this purpose. This turns out to be a bad idea in this context for two reasons. The first reason is that the warmup iterations allow the sampler to wander past the global modes and get stuck in suboptimal modes far from the groove locations, from which the sampler may or may not find its way back to the optimal modes. Secondly, if the sampler does wander past the optimal modes, which are usually on the edges of the data, the tuned proposal variance can be quite large. The large proposal variance might not be a huge problem if it weren’t for the fact that the width of the modes are almost always quite small. This means that it can take a very, very long time for the sampler to move from a suboptimal mode to the global mode. In order to mitigate this problem, we are currently setting the number of warmup iterations to be relatively small (somewhere in 100 to 500 seems to work well). In future iterations of these functions, we will remove the necessity of having warmup iterations or tuned proposal variances.</p>
<p>We now provide the two basic steps of the Gibbs sampler for the two changepoint case. The algorithms to sample from the other three models are omitted, and are nearly identical except for the a smaller number of parameters need to be sampled. Denote collection of mean and covariance parameters for the left GEA as <span class="math inline">\(\theta_1\)</span>, the LEA as <span class="math inline">\(\theta_2\)</span>, and the right GEA as <span class="math inline">\(\theta_3\)</span>. Then, at iteration <span class="math inline">\(t\)</span> after warmup</p>
<ol style="list-style-type: decimal">
<li>given changepoint locations <span class="math inline">\((c_l^{(t - 1)}, c_r^{(t - 1)})\)</span>, sample <span class="math inline">\((\theta_1^{(t)}, \theta_2^{(t)}, \theta_3^{(t)})\)</span> using independent RWMH steps for each <span class="math inline">\(\theta_i\)</span></li>
<li>given <span class="math inline">\((\theta_1^{(t)}, \theta_2^{(t)}, \theta_3^{(t)})\)</span>, sample <span class="math inline">\((c_l^{(t)}, c_r^{(t)})\)</span> using a single RWMH step.</li>
</ol>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
